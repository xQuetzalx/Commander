<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Commander Arena - MTG</title>
  <meta name="theme-color" content="#5b21b6">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘‘</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior: none; -webkit-font-smoothing: antialiased; }
    html { scroll-behavior: smooth; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
    ::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); border-radius: 4px; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
    import { Search, Plus, Trash2, Users, Play, Home, BookOpen, Download, X, Crown, Info, ChevronLeft, MoreVertical, Heart, Swords, Skull, MessageCircle, Send, Copy } from 'https://esm.sh/lucide-react@0.263.1';

    // Mock storage para cuando window.storage no estÃ© disponible
    const storage = window.storage || {
      async get(key) {
        const item = localStorage.getItem(key);
        return item ? { key, value: item } : null;
      },
      async set(key, value) {
        localStorage.setItem(key, value);
        return { key, value };
      }
    };

    function MTGCommanderApp() {
      const [currentView, setCurrentView] = useState('home');
      const [decks, setDecks] = useState([]);
      const [playerName, setPlayerName] = useState('');
      const [showImportModal, setShowImportModal] = useState(false);
      const [showDeckDetail, setShowDeckDetail] = useState(null);
      const [importText, setImportText] = useState('');
      const [importError, setImportError] = useState('');
      const [loading, setLoading] = useState(false);

      useEffect(() => {
        loadDecks();
        loadPlayerName();
      }, []);

      const loadDecks = async () => {
        try {
          const result = await storage.get('mtg-decks');
          if (result?.value) setDecks(JSON.parse(result.value));
        } catch (e) {}
      };

      const loadPlayerName = async () => {
        try {
          const result = await storage.get('mtg-player-name');
          if (result?.value) setPlayerName(result.value);
        } catch (e) {}
      };

      const saveDecks = async (newDecks) => {
        await storage.set('mtg-decks', JSON.stringify(newDecks));
        setDecks(newDecks);
      };

      const savePlayerName = async (name) => {
        await storage.set('mtg-player-name', name);
        setPlayerName(name);
      };

      const parseMoxfieldDeck = (text) => {
        setImportError('');
        if (!text.trim()) {
          setImportError('El texto estÃ¡ vacÃ­o');
          return null;
        }

        const lines = text.split('\n').filter(line => line.trim());
        const cards = [];
        let deckName = 'Mazo Importado ' + new Date().toLocaleDateString();

        for (let line of lines) {
          if (line.match(/^(Commander|Deck|Companion|Sideboard):/i)) continue;
          if (!line.trim() || line.startsWith('//') || line.startsWith('#')) continue;

          let match = line.match(/^(\d+)x?\s+(.+?)(?:\s+\([A-Z0-9]+\))?(?:\s+\d+)?$/);
          if (!match) {
            match = line.match(/^(.+?)(?:\s+\([A-Z0-9]+\))?(?:\s+\d+)?$/);
            if (match) match = [line, '1', match[1]];
          }

          if (match) {
            const quantity = parseInt(match[1]);
            let cardName = match[2].trim().replace(/\s+\([A-Z0-9]+\)\s*\d*$/, '').trim();
            if (cardName) cards.push({ name: cardName, quantity });
          }
        }

        if (cards.length === 0) {
          setImportError('No se encontraron cartas vÃ¡lidas');
          return null;
        }

        return {
          name: deckName,
          cards,
          createdAt: new Date().toISOString(),
          totalCards: cards.reduce((sum, c) => sum + c.quantity, 0)
        };
      };

      const handleImportDeck = () => {
        const newDeck = parseMoxfieldDeck(importText);
        if (newDeck) {
          const updatedDecks = [...decks, { ...newDeck, id: Date.now().toString() }];
          saveDecks(updatedDecks);
          setImportText('');
          setShowImportModal(false);
          setImportError('');
        }
      };

      const handleDeleteDeck = (deckId) => {
        if (confirm('Â¿EstÃ¡s seguro de eliminar este mazo?')) {
          saveDecks(decks.filter(d => d.id !== deckId));
        }
      };

      const startGame = (deck) => {
        alert('Funcionalidad de juego prÃ³ximamente. Por ahora puedes:\n\nâ€¢ Importar mazos desde Moxfield\nâ€¢ Ver tus mazos guardados\nâ€¢ Gestionar tu colecciÃ³n');
      };

      // Vista Home
      if (currentView === 'home') {
        return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950" },
          React.createElement('div', { className: "relative overflow-hidden" },
            React.createElement('div', { className: "absolute inset-0 bg-gradient-to-r from-violet-600/20 via-fuchsia-600/20 to-violet-600/20 blur-3xl" }),
            React.createElement('div', { className: "relative backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
              React.createElement('div', { className: "px-6 py-8" },
                React.createElement('div', { className: "flex items-center gap-3 mb-2" },
                  React.createElement(Crown, { className: "w-10 h-10 text-amber-400" }),
                  React.createElement('h1', {
                    className: "text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-violet-200 via-fuchsia-200 to-violet-200",
                    style: { fontFamily: 'Palatino, serif' }
                  }, 'Commander Arena')
                ),
                React.createElement('p', { className: "text-violet-300/70 text-sm ml-13" }, 'Tu mesa digital de Magic: The Gathering')
              )
            )
          ),
          React.createElement('div', { className: "px-6 py-8 space-y-6" },
            React.createElement('div', { className: "backdrop-blur-xl bg-white/5 border border-violet-500/20 rounded-2xl p-6 shadow-2xl" },
              React.createElement('label', { className: "flex items-center gap-2 text-violet-300 text-sm font-semibold mb-3" },
                React.createElement(Users, { className: "w-4 h-4" }),
                'Tu Identidad'
              ),
              React.createElement('input', {
                type: "text",
                value: playerName,
                onChange: (e) => savePlayerName(e.target.value),
                placeholder: "Introduce tu nombre...",
                className: "w-full bg-slate-900/50 border border-violet-500/30 rounded-xl px-4 py-3 text-white placeholder-violet-400/40 focus:outline-none focus:border-violet-400 transition-all"
              })
            ),
            React.createElement('button', {
              onClick: () => setCurrentView('decks'),
              className: "w-full group backdrop-blur-xl bg-gradient-to-r from-violet-600/20 to-fuchsia-600/20 hover:from-violet-600/30 hover:to-fuchsia-600/30 border border-violet-500/30 rounded-2xl p-6 transition-all shadow-xl"
            },
              React.createElement('div', { className: "flex items-center justify-between" },
                React.createElement('div', { className: "flex items-center gap-4" },
                  React.createElement('div', { className: "p-3 bg-violet-500/20 rounded-xl" },
                    React.createElement(BookOpen, { className: "w-7 h-7 text-violet-300" })
                  ),
                  React.createElement('div', { className: "text-left" },
                    React.createElement('h3', { className: "text-xl font-bold text-white mb-1" }, 'Mis Mazos'),
                    React.createElement('p', { className: "text-violet-300/70 text-sm" }, `${decks.length} mazos guardados`)
                  )
                ),
                React.createElement(ChevronLeft, { className: "w-6 h-6 text-violet-300/50 rotate-180 group-hover:translate-x-1 transition-transform" })
              )
            ),
            React.createElement('div', { className: "backdrop-blur-xl bg-violet-500/5 border border-violet-500/20 rounded-2xl p-6" },
              React.createElement('div', { className: "flex items-start gap-3" },
                React.createElement(Info, { className: "w-5 h-5 text-violet-400 mt-0.5" }),
                React.createElement('div', null,
                  React.createElement('h3', { className: "text-violet-200 font-semibold mb-2" }, 'CÃ³mo Empezar'),
                  React.createElement('ul', { className: "space-y-2 text-violet-300/70 text-sm" },
                    React.createElement('li', null, '1. Importa tus mazos desde Moxfield'),
                    React.createElement('li', null, '2. Gestiona tu colecciÃ³n'),
                    React.createElement('li', null, '3. Juego multijugador prÃ³ximamente')
                  )
                )
              )
            )
          )
        );
      }

      // Vista Decks
      if (currentView === 'decks') {
        return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950" },
          React.createElement('div', { className: "sticky top-0 z-20 backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
            React.createElement('div', { className: "px-6 py-4 flex items-center justify-between" },
              React.createElement('div', { className: "flex items-center gap-3" },
                React.createElement('button', {
                  onClick: () => setCurrentView('home'),
                  className: "text-violet-300 hover:text-violet-200"
                }, React.createElement(ChevronLeft, { className: "w-6 h-6" })),
                React.createElement('h2', { className: "text-2xl font-bold text-white" }, 'Mis Mazos')
              ),
              React.createElement('button', {
                onClick: () => setShowImportModal(true),
                className: "flex items-center gap-2 bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white px-4 py-2 rounded-xl shadow-lg"
              },
                React.createElement(Plus, { className: "w-5 h-5" }),
                'Importar'
              )
            )
          ),
          React.createElement('div', { className: "p-6 space-y-4" },
            decks.length === 0 ?
              React.createElement('div', { className: "text-center py-16" },
                React.createElement(BookOpen, { className: "w-20 h-20 text-violet-400/30 mx-auto mb-4" }),
                React.createElement('p', { className: "text-violet-300/70 text-lg" }, 'No tienes mazos guardados'),
                React.createElement('p', { className: "text-violet-400/50 text-sm mt-2" }, 'Importa un mazo desde Moxfield')
              ) :
              decks.map(deck =>
                React.createElement('div', {
                  key: deck.id,
                  className: "backdrop-blur-xl bg-white/5 border border-violet-500/20 rounded-2xl p-5"
                },
                  React.createElement('div', { className: "flex justify-between mb-4" },
                    React.createElement('div', null,
                      React.createElement('h3', { className: "text-xl font-bold text-white mb-2" }, deck.name),
                      React.createElement('p', { className: "text-violet-400/60 text-sm" }, `${deck.totalCards} cartas`)
                    ),
                    React.createElement('button', {
                      onClick: () => setShowDeckDetail(deck),
                      className: "text-violet-400 hover:text-violet-300"
                    }, React.createElement(MoreVertical, { className: "w-5 h-5" }))
                  ),
                  React.createElement('button', {
                    onClick: () => startGame(deck),
                    className: "w-full bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-semibold"
                  },
                    React.createElement(Play, { className: "w-5 h-5" }),
                    'Ver Detalles'
                  )
                )
              )
          ),
          showImportModal && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" },
            React.createElement('div', { className: "backdrop-blur-xl bg-slate-900/95 border border-violet-500/30 rounded-2xl max-w-2xl w-full" },
              React.createElement('div', { className: "px-6 py-5 border-b border-violet-500/20 flex items-center justify-between" },
                React.createElement('h3', { className: "text-2xl font-bold text-white" }, 'Importar Mazo'),
                React.createElement('button', {
                  onClick: () => {
                    setShowImportModal(false);
                    setImportError('');
                    setImportText('');
                  },
                  className: "text-violet-400"
                }, React.createElement(X, { className: "w-6 h-6" }))
              ),
              React.createElement('div', { className: "p-6" },
                React.createElement('p', { className: "text-violet-300 text-sm mb-4" }, 'Pega el texto de Moxfield:'),
                React.createElement('textarea', {
                  value: importText,
                  onChange: (e) => setImportText(e.target.value),
                  placeholder: "1 Sol Ring\n1 Command Tower\n...",
                  className: "w-full h-80 bg-slate-800/50 border border-violet-500/30 rounded-xl px-4 py-3 text-white placeholder-violet-400/40 focus:outline-none resize-none font-mono text-sm"
                }),
                importError && React.createElement('div', { className: "mt-4 bg-red-500/10 border border-red-500/30 rounded-lg p-4" },
                  React.createElement('p', { className: "text-red-300 text-sm" }, importError)
                )
              ),
              React.createElement('div', { className: "px-6 py-5 border-t border-violet-500/20 flex gap-3" },
                React.createElement('button', {
                  onClick: () => {
                    setShowImportModal(false);
                    setImportError('');
                    setImportText('');
                  },
                  className: "flex-1 bg-slate-700/50 text-white rounded-xl px-4 py-3 font-semibold"
                }, 'Cancelar'),
                React.createElement('button', {
                  onClick: handleImportDeck,
                  className: "flex-1 bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-semibold"
                },
                  React.createElement(Download, { className: "w-5 h-5" }),
                  'Importar'
                )
              )
            )
          ),
          showDeckDetail && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" },
            React.createElement('div', { className: "backdrop-blur-xl bg-slate-900/95 border border-violet-500/30 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col" },
              React.createElement('div', { className: "px-6 py-5 border-b border-violet-500/20 flex items-center justify-between" },
                React.createElement('h3', { className: "text-2xl font-bold text-white" }, showDeckDetail.name),
                React.createElement('button', {
                  onClick: () => setShowDeckDetail(null),
                  className: "text-violet-400"
                }, React.createElement(X, { className: "w-6 h-6" }))
              ),
              React.createElement('div', { className: "p-6 flex-1 overflow-y-auto" },
                React.createElement('p', { className: "text-violet-400/60 text-sm mb-6" }, `${showDeckDetail.totalCards} cartas totales`),
                React.createElement('div', { className: "space-y-2" },
                  showDeckDetail.cards.map((card, i) =>
                    React.createElement('div', {
                      key: i,
                      className: "flex items-center justify-between bg-slate-800/30 border border-violet-500/10 rounded-lg px-4 py-3"
                    },
                      React.createElement('span', { className: "text-violet-200" }, card.name),
                      React.createElement('span', { className: "text-violet-400/60 text-sm" }, `x${card.quantity}`)
                    )
                  )
                )
              ),
              React.createElement('div', { className: "px-6 py-5 border-t border-violet-500/20" },
                React.createElement('button', {
                  onClick: () => {
                    if (confirm('Â¿Eliminar este mazo?')) {
                      handleDeleteDeck(showDeckDetail.id);
                      setShowDeckDetail(null);
                    }
                  },
                  className: "w-full bg-red-500/20 border border-red-500/30 text-red-300 rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-semibold"
                },
                  React.createElement(Trash2, { className: "w-5 h-5" }),
                  'Eliminar Mazo'
                )
              )
            )
          )
        );
      }

      return null;
    }

    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(MTGCommanderApp));
  </script>
</body>
</html>
