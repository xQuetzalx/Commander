<!DOCTYPE html>

<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commander Arena</title>
  <meta name="theme-color" content="#5b21b6">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘‘</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior: none; -webkit-font-smoothing: antialiased; }
    html { scroll-behavior: smooth; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
    ::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); border-radius: 4px; }
    .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18';
    import { createRoot } from 'https://esm.sh/react-dom@18/client';
    import { Search, Plus, Trash2, Users, Play, Home, BookOpen, Download, X, Crown, Info, ChevronLeft, MoreVertical, Heart, Swords, Skull, MessageCircle, Send, Copy, Sparkles, Loader2 } from 'https://esm.sh/lucide-react@0.263.1';

```
function MTGCommanderApp() {
  const [currentView, setCurrentView] = useState('home');
  const [decks, setDecks] = useState([]);
  const [playerName, setPlayerName] = useState('');
  const [showImportModal, setShowImportModal] = useState(false);
  const [showDeckDetail, setShowDeckDetail] = useState(null);
  const [importText, setImportText] = useState('');
  const [importError, setImportError] = useState('');
  const [loading, setLoading] = useState(false);
  
  // NUEVO: Cards explorer
  const [cards, setCards] = useState([]);
  const [searchCard, setSearchCard] = useState('');
  const [loadingCards, setLoadingCards] = useState(false);
  const [selectedCard, setSelectedCard] = useState(null);
  
  // NUEVO: Multiplayer
  const [currentGame, setCurrentGame] = useState(null);
  const [showChat, setShowChat] = useState(false);
  const [chatMessage, setChatMessage] = useState('');
  const chatEndRef = useRef(null);

  // Storage wrapper
  const storage = window.storage || {
    async get(key, shared = false) {
      const item = localStorage.getItem(shared ? 'shared-' + key : key);
      return item ? { key, value: item } : null;
    },
    async set(key, value, shared = false) {
      localStorage.setItem(shared ? 'shared-' + key : key, value);
      return { key, value };
    }
  };

  useEffect(() => {
    loadDecks();
    loadPlayerName();
  }, []);

  const loadDecks = async () => {
    try {
      const result = await storage.get('mtg-decks');
      if (result && result.value) setDecks(JSON.parse(result.value));
    } catch (e) {}
  };

  const loadPlayerName = async () => {
    try {
      const result = await storage.get('mtg-player-name');
      if (result && result.value) setPlayerName(result.value);
    } catch (e) {}
  };

  const saveDecks = async (newDecks) => {
    await storage.set('mtg-decks', JSON.stringify(newDecks));
    setDecks(newDecks);
  };

  const savePlayerName = async (name) => {
    await storage.set('mtg-player-name', name);
    setPlayerName(name);
  };

  // NUEVO: Search cards
  const searchCards = async (query = '') => {
    setLoadingCards(true);
    try {
      const q = query || 'format:commander';
      const response = await fetch('https://api.scryfall.com/cards/search?q=' + encodeURIComponent(q) + '&order=edhrec');
      const data = await response.json();
      if (data.data) setCards(data.data);
    } catch (e) {
      console.error('Error buscando cartas:', e);
    }
    setLoadingCards(false);
  };

  const parseMoxfieldDeck = (text) => {
    setImportError('');
    if (!text.trim()) {
      setImportError('El texto estÃ¡ vacÃ­o');
      return null;
    }

    const lines = text.split('\\n').filter(line => line.trim());
    const cards = [];
    let deckName = 'Mazo Importado ' + new Date().toLocaleDateString();
    let commander = null;

    for (let line of lines) {
      if (line.match(/^(Commander|Deck):/i)) {
        const match = line.match(/^(Commander|Deck):\\s*(.+)/i);
        if (match && match[1].toLowerCase() === 'deck') deckName = match[2].trim();
        if (match && match[1].toLowerCase() === 'commander') commander = match[2].trim();
        continue;
      }
      if (!line.trim() || line.startsWith('//') || line.startsWith('#')) continue;

      let match = line.match(/^(\\d+)x?\\s+(.+?)(?:\\s+\\([A-Z0-9]+\\))?(?:\\s+\\d+)?$/);
      if (!match) {
        match = line.match(/^(.+?)(?:\\s+\\([A-Z0-9]+\\))?(?:\\s+\\d+)?$/);
        if (match) match = [line, '1', match[1]];
      }

      if (match) {
        const quantity = parseInt(match[1]);
        let cardName = match[2].trim().replace(/\\s+\\([A-Z0-9]+\\)\\s*\\d*$/, '').trim();
        if (cardName) {
          if (!commander && cards.length === 0) commander = cardName;
          cards.push({ name: cardName, quantity });
        }
      }
    }

    if (cards.length === 0) {
      setImportError('No se encontraron cartas vÃ¡lidas');
      return null;
    }

    return {
      name: deckName,
      commander,
      cards,
      createdAt: new Date().toISOString(),
      totalCards: cards.reduce((sum, c) => sum + c.quantity, 0)
    };
  };

  const handleImportDeck = () => {
    const newDeck = parseMoxfieldDeck(importText);
    if (newDeck) {
      const updatedDecks = [...decks, { ...newDeck, id: Date.now().toString() }];
      saveDecks(updatedDecks);
      setImportText('');
      setShowImportModal(false);
      setImportError('');
    }
  };

  const handleDeleteDeck = (deckId) => {
    if (confirm('Â¿EstÃ¡s seguro de eliminar este mazo?')) {
      saveDecks(decks.filter(d => d.id !== deckId));
    }
  };

  // NUEVO: Start game
  const startGame = async (deck) => {
    if (!playerName.trim()) {
      alert('Introduce tu nombre primero');
      return;
    }

    const gameId = 'game-' + Date.now();
    const game = {
      id: gameId,
      players: [{
        id: Date.now().toString(),
        name: playerName,
        life: 40,
        commanderDamage: {},
        poison: 0,
        deck: deck,
        color: '#8b5cf6'
      }],
      messages: [],
      turn: 1,
      createdAt: new Date().toISOString()
    };

    await storage.set(gameId, JSON.stringify(game), true);
    setCurrentGame(game);
    setCurrentView('game');
  };

  // NUEVO: Join game
  const joinGame = async () => {
    const gameId = prompt('Introduce el ID de la partida:');
    if (!gameId) return;

    if (!playerName.trim()) {
      alert('Introduce tu nombre primero');
      return;
    }

    try {
      const result = await storage.get(gameId, true);
      if (result && result.value) {
        const game = JSON.parse(result.value);
        
        const existingPlayer = game.players.find(p => p.name === playerName);
        if (!existingPlayer) {
          const colors = ['#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#3b82f6', '#ef4444'];
          const usedColors = game.players.map(p => p.color);
          const availableColor = colors.find(c => !usedColors.includes(c)) || colors[0];
          
          game.players.push({
            id: Date.now().toString(),
            name: playerName,
            life: 40,
            commanderDamage: {},
            poison: 0,
            deck: null,
            color: availableColor
          });
          
          await storage.set(gameId, JSON.stringify(game), true);
        }
        
        setCurrentGame(game);
        setCurrentView('game');
      } else {
        alert('No se encontrÃ³ la partida con ese ID');
      }
    } catch (error) {
      console.error('Error uniÃ©ndose a la partida:', error);
      alert('Error al unirse a la partida');
    }
  };

  // NUEVO: Game functions
  const updateGame = async (updatedGame) => {
    try {
      await storage.set(updatedGame.id, JSON.stringify(updatedGame), true);
      setCurrentGame(updatedGame);
    } catch (error) {
      console.error('Error actualizando partida:', error);
    }
  };

  const updatePlayerLife = (playerId, amount) => {
    const updatedGame = {
      ...currentGame,
      players: currentGame.players.map(p =>
        p.id === playerId ? { ...p, life: Math.max(0, p.life + amount) } : p
      )
    };
    updateGame(updatedGame);
  };

  const updateCommanderDamage = (playerId, fromPlayerId, amount) => {
    const updatedGame = {
      ...currentGame,
      players: currentGame.players.map(p => {
        if (p.id === playerId) {
          const currentDamage = p.commanderDamage[fromPlayerId] || 0;
          return {
            ...p,
            commanderDamage: {
              ...p.commanderDamage,
              [fromPlayerId]: Math.max(0, currentDamage + amount)
            }
          };
        }
        return p;
      })
    };
    updateGame(updatedGame);
  };

  const updatePoison = (playerId, amount) => {
    const updatedGame = {
      ...currentGame,
      players: currentGame.players.map(p =>
        p.id === playerId ? { ...p, poison: Math.max(0, Math.min(10, p.poison + amount)) } : p
      )
    };
    updateGame(updatedGame);
  };

  const sendMessage = () => {
    if (!chatMessage.trim()) return;

    const updatedGame = {
      ...currentGame,
      messages: [
        ...currentGame.messages,
        {
          id: Date.now().toString(),
          player: playerName,
          text: chatMessage,
          timestamp: new Date().toISOString()
        }
      ]
    };
    updateGame(updatedGame);
    setChatMessage('');
  };

  const copyGameId = () => {
    navigator.clipboard.writeText(currentGame.id);
    alert('ID copiado al portapapeles: ' + currentGame.id);
  };

  // Poll para actualizar la partida
  useEffect(() => {
    if (!currentGame) return;

    const interval = setInterval(async () => {
      try {
        const result = await storage.get(currentGame.id, true);
        if (result && result.value) {
          const game = JSON.parse(result.value);
          setCurrentGame(game);
        }
      } catch (error) {
        console.error('Error cargando partida:', error);
      }
    }, 3000);

    return () => clearInterval(interval);
  }, [currentGame?.id]);

  // Auto-scroll del chat
  useEffect(() => {
    if (showChat && chatEndRef.current) {
      chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [currentGame?.messages, showChat]);

  // Vista principal HOME
  if (currentView === 'home') {
    return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950" },
      React.createElement('div', { className: "relative overflow-hidden" },
        React.createElement('div', { className: "absolute inset-0 bg-gradient-to-r from-violet-600/20 via-fuchsia-600/20 to-violet-600/20 blur-3xl" }),
        React.createElement('div', { className: "relative backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
          React.createElement('div', { className: "px-6 py-8" },
            React.createElement('div', { className: "flex items-center gap-3 mb-2" },
              React.createElement(Crown, { className: "w-10 h-10 text-amber-400" }),
              React.createElement('h1', {
                className: "text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-violet-200 via-fuchsia-200 to-violet-200",
                style: { fontFamily: 'Palatino, serif' }
              }, 'Commander Arena')
            ),
            React.createElement('p', { className: "text-violet-300/70 text-sm ml-13" }, 'Explora cartas y juega Commander online')
          )
        )
      ),
      React.createElement('div', { className: "px-6 py-8 space-y-6" },
        React.createElement('div', { className: "backdrop-blur-xl bg-white/5 border border-violet-500/20 rounded-2xl p-6 shadow-2xl" },
          React.createElement('label', { className: "flex items-center gap-2 text-violet-300 text-sm font-semibold mb-3" },
            React.createElement(Users, { className: "w-4 h-4" }),
            'Tu Identidad'
          ),
          React.createElement('input', {
            type: "text",
            value: playerName,
            onChange: (e) => savePlayerName(e.target.value),
            placeholder: "Introduce tu nombre de invocador...",
            className: "w-full bg-slate-900/50 border border-violet-500/30 rounded-xl px-4 py-3 text-white placeholder-violet-400/40 focus:outline-none focus:border-violet-400 focus:ring-2 focus:ring-violet-400/20 transition-all"
          })
        ),
        React.createElement('div', { className: "grid gap-4" },
          React.createElement('button', {
            onClick: () => {
              setCurrentView('cards');
              searchCards('');
            },
            className: "group relative overflow-hidden backdrop-blur-xl bg-gradient-to-r from-pink-600/20 to-purple-600/20 hover:from-pink-600/30 hover:to-purple-600/30 border border-pink-500/30 rounded-2xl p-6 transition-all hover:scale-[1.02] active:scale-[0.98] shadow-xl"
          },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "flex items-center gap-4" },
                React.createElement('div', { className: "p-3 bg-pink-500/20 rounded-xl" },
                  React.createElement(Sparkles, { className: "w-7 h-7 text-pink-300" })
                ),
                React.createElement('div', { className: "text-left" },
                  React.createElement('h3', { className: "text-xl font-bold text-white mb-1" }, 'Explorar Cartas'),
                  React.createElement('p', { className: "text-pink-300/70 text-sm" }, 'Ver todas las cartas de Magic')
                )
              ),
              React.createElement(ChevronLeft, { className: "w-6 h-6 text-pink-300/50 rotate-180 group-hover:translate-x-1 transition-transform" })
            )
          ),
          React.createElement('button', {
            onClick: () => setCurrentView('decks'),
            className: "group relative overflow-hidden backdrop-blur-xl bg-gradient-to-r from-violet-600/20 to-fuchsia-600/20 hover:from-violet-600/30 hover:to-fuchsia-600/30 border border-violet-500/30 rounded-2xl p-6 transition-all hover:scale-[1.02] active:scale-[0.98] shadow-xl"
          },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "flex items-center gap-4" },
                React.createElement('div', { className: "p-3 bg-violet-500/20 rounded-xl" },
                  React.createElement(BookOpen, { className: "w-7 h-7 text-violet-300" })
                ),
                React.createElement('div', { className: "text-left" },
                  React.createElement('h3', { className: "text-xl font-bold text-white mb-1" }, 'Mis Mazos'),
                  React.createElement('p', { className: "text-violet-300/70 text-sm" }, decks.length + ' mazos guardados')
                )
              ),
              React.createElement(ChevronLeft, { className: "w-6 h-6 text-violet-300/50 rotate-180 group-hover:translate-x-1 transition-transform" })
            )
          ),
          React.createElement('button', {
            onClick: joinGame,
            className: "group relative overflow-hidden backdrop-blur-xl bg-gradient-to-r from-blue-600/20 to-cyan-600/20 hover:from-blue-600/30 hover:to-cyan-600/30 border border-blue-500/30 rounded-2xl p-6 transition-all hover:scale-[1.02] active:scale-[0.98] shadow-xl"
          },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "flex items-center gap-4" },
                React.createElement('div', { className: "p-3 bg-blue-500/20 rounded-xl" },
                  React.createElement(Users, { className: "w-7 h-7 text-blue-300" })
                ),
                React.createElement('div', { className: "text-left" },
                  React.createElement('h3', { className: "text-xl font-bold text-white mb-1" }, 'Unirse a Partida'),
                  React.createElement('p', { className: "text-blue-300/70 text-sm" }, 'Juega Commander online con amigos')
                )
              ),
              React.createElement(ChevronLeft, { className: "w-6 h-6 text-blue-300/50 rotate-180 group-hover:translate-x-1 transition-transform" })
            )
          )
        )
      )
    );
  }

  // NUEVO: Vista EXPLORADOR DE CARTAS
  if (currentView === 'cards') {
    return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950 pb-6" },
      React.createElement('div', { className: "sticky top-0 z-20 backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
        React.createElement('div', { className: "px-4 py-4 flex items-center gap-3" },
          React.createElement('button', {
            onClick: () => setCurrentView('home'),
            className: "text-violet-300 hover:text-violet-200 transition-colors"
          }, React.createElement(ChevronLeft, { className: "w-6 h-6" })),
          React.createElement('div', { className: "flex-1 relative" },
            React.createElement(Search, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-violet-400" }),
            React.createElement('input', {
              type: "text",
              value: searchCard,
              onChange: (e) => setSearchCard(e.target.value),
              onKeyPress: (e) => e.key === 'Enter' && searchCards(searchCard),
              placeholder: "Buscar cartas...",
              className: "w-full pl-10 pr-4 py-2 bg-slate-900/50 border border-violet-500/30 rounded-xl text-white placeholder-violet-400/40 focus:outline-none focus:border-violet-400 text-sm"
            })
          )
        )
      ),
      React.createElement('div', { className: "px-4 py-4" },
        loadingCards ?
          React.createElement('div', { className: "flex justify-center py-12" },
            React.createElement(Loader2, { className: "w-8 h-8 animate-spin text-violet-400" })
          ) :
          React.createElement('div', { className: "card-grid" },
            cards.map(card =>
              React.createElement('div', {
                key: card.id,
                onClick: () => setSelectedCard(card),
                className: "bg-slate-800/30 rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform shadow-lg"
              },
                React.createElement('img', {
                  src: card.image_uris?.normal || card.card_faces?.[0]?.image_uris?.normal || 'https://via.placeholder.com/244x340',
                  alt: card.name,
                  className: "w-full h-auto"
                })
              )
            )
          )
      ),
      selectedCard && React.createElement('div', {
        onClick: () => setSelectedCard(null),
        className: "fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50"
      },
        React.createElement('img', {
          src: selectedCard.image_uris?.large || selectedCard.image_uris?.normal || selectedCard.card_faces?.[0]?.image_uris?.large,
          alt: selectedCard.name,
          className: "max-w-full max-h-[90vh] rounded-xl shadow-2xl",
          onClick: (e) => e.stopPropagation()
        })
      )
    );
  }

  // Vista de mazos (IGUAL QUE ANTES, SIN CAMBIOS)
  if (currentView === 'decks') {
    return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950" },
      React.createElement('div', { className: "sticky top-0 z-20 backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
        React.createElement('div', { className: "px-6 py-4 flex items-center justify-between" },
          React.createElement('div', { className: "flex items-center gap-3" },
            React.createElement('button', {
              onClick: () => setCurrentView('home'),
              className: "text-violet-300 hover:text-violet-200 transition-colors"
            }, React.createElement(ChevronLeft, { className: "w-6 h-6" })),
            React.createElement('h2', { className: "text-2xl font-bold text-white" }, 'Mis Mazos')
          ),
          React.createElement('button', {
            onClick: () => setShowImportModal(true),
            className: "flex items-center gap-2 bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white px-4 py-2 rounded-xl transition-all shadow-lg"
          },
            React.createElement(Plus, { className: "w-5 h-5" }),
            'Importar'
          )
        )
      ),
      React.createElement('div', { className: "p-6 space-y-4" },
        decks.length === 0 ?
          React.createElement('div', { className: "text-center py-16" },
            React.createElement(BookOpen, { className: "w-20 h-20 text-violet-400/30 mx-auto mb-4" }),
            React.createElement('p', { className: "text-violet-300/70 text-lg mb-2" }, 'No tienes mazos guardados'),
            React.createElement('p', { className: "text-violet-400/50 text-sm" }, 'Importa un mazo desde Moxfield para comenzar')
          ) :
          decks.map(deck =>
            React.createElement('div', {
              key: deck.id,
              className: "group backdrop-blur-xl bg-white/5 border border-violet-500/20 hover:border-violet-400/40 rounded-2xl p-5 transition-all hover:shadow-2xl hover:shadow-violet-500/10"
            },
              React.createElement('div', { className: "flex items-start justify-between mb-4" },
                React.createElement('div', { className: "flex-1" },
                  React.createElement('h3', { className: "text-xl font-bold text-white mb-2" }, deck.name),
                  deck.commander && React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                    React.createElement(Crown, { className: "w-4 h-4 text-amber-400" }),
                    React.createElement('span', { className: "text-violet-300" }, deck.commander)
                  ),
                  React.createElement('div', { className: "flex items-center gap-4 text-sm text-violet-400/60" },
                    React.createElement('span', null, (deck.totalCards || deck.cards.reduce((sum, c) => sum + c.quantity, 0)) + ' cartas'),
                    React.createElement('span', null, 'â€¢'),
                    React.createElement('span', null, new Date(deck.createdAt).toLocaleDateString('es-ES'))
                  )
                ),
                React.createElement('div', { className: "flex gap-2" },
                  React.createElement('button', {
                    onClick: () => setShowDeckDetail(deck),
                    className: "p-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 rounded-lg transition-all"
                  }, React.createElement(MoreVertical, { className: "w-5 h-5" }))
                )
              ),
              React.createElement('button', {
                onClick: () => startGame(deck),
                className: "w-full bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-all shadow-lg font-semibold"
              },
                React.createElement(Play, { className: "w-5 h-5" }),
                'Iniciar Partida'
              )
            )
          )
      ),
      showImportModal && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" },
        React.createElement('div', { className: "backdrop-blur-xl bg-slate-900/95 border border-violet-500/30 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl" },
          React.createElement('div', { className: "px-6 py-5 border-b border-violet-500/20 flex items-center justify-between" },
            React.createElement('h3', { className: "text-2xl font-bold text-white" }, 'Importar Mazo'),
            React.createElement('button', {
              onClick: () => {
                setShowImportModal(false);
                setImportError('');
                setImportText('');
              },
              className: "text-violet-400 hover:text-violet-300 transition-colors"
            }, React.createElement(X, { className: "w-6 h-6" }))
          ),
          React.createElement('div', { className: "p-6 flex-1 overflow-y-auto" },
            React.createElement('div', { className: "mb-4" },
              React.createElement('p', { className: "text-violet-300 text-sm mb-2" }, 'Pega el contenido de tu archivo .txt exportado desde Moxfield:'),
              React.createElement('div', { className: "bg-violet-500/10 border border-violet-500/20 rounded-lg p-3 mb-4" },
                React.createElement('p', { className: "text-violet-300/70 text-xs font-mono" }, 'Formato esperado:\nCommander:\nAtraxa, Praetors\' Voice\n\n1 Sol Ring\n1 Command Tower\n1 Arcane Signet\n...')
              )
            ),
            React.createElement('textarea', {
              value: importText,
              onChange: (e) => setImportText(e.target.value),
              placeholder: "Commander:\nAtraxa, Praetors' Voice\n\n1 Sol Ring\n1 Command Tower\n1 Arcane Signet\n...",
              className: "w-full h-80 bg-slate-800/50 border border-violet-500/30 rounded-xl px-4 py-3 text-white placeholder-violet-400/40 focus:outline-none focus:border-violet-400 focus:ring-2 focus:ring-violet-400/20 resize-none font-mono text-sm transition-all"
            }),
            importError && React.createElement('div', { className: "mt-4 bg-red-500/10 border border-red-500/30 rounded-lg p-4" },
              React.createElement('p', { className: "text-red-300 text-sm" }, importError)
            )
          ),
          React.createElement('div', { className: "px-6 py-5 border-t border-violet-500/20 flex gap-3" },
            React.createElement('button', {
              onClick: () => {
                setShowImportModal(false);
                setImportError('');
                setImportText('');
              },
              className: "flex-1 bg-slate-700/50 hover:bg-slate-700 text-white rounded-xl px-4 py-3 transition-all font-semibold"
            }, 'Cancelar'),
            React.createElement('button', {
              onClick: handleImportDeck,
              className: "flex-1 bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-all shadow-lg font-semibold"
            },
              React.createElement(Download, { className: "w-5 h-5" }),
              'Importar Mazo'
            )
          )
        )
      ),
      showDeckDetail && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" },
        React.createElement('div', { className: "backdrop-blur-xl bg-slate-900/95 border border-violet-500/30 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl" },
          React.createElement('div', { className: "px-6 py-5 border-b border-violet-500/20 flex items-center justify-between" },
            React.createElement('h3', { className: "text-2xl font-bold text-white" }, showDeckDetail.name),
            React.createElement('button', {
              onClick: () => setShowDeckDetail(null),
              className: "text-violet-400 hover:text-violet-300 transition-colors"
            }, React.createElement(X, { className: "w-6 h-6" }))
          ),
          React.createElement('div', { className: "p-6 flex-1 overflow-y-auto" },
            React.createElement('div', { className: "mb-6" },
              showDeckDetail.commander && React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                React.createElement(Crown, { className: "w-5 h-5 text-amber-400" }),
                React.createElement('span', { className: "text-violet-200 font-semibold" }, showDeckDetail.commander)
              ),
              React.createElement('p', { className: "text-violet-400/60 text-sm" }, (showDeckDetail.totalCards || showDeckDetail.cards.reduce((sum, c) => sum + c.quantity, 0)) + ' cartas totales')
            ),
            React.createElement('div', { className: "space-y-2" },
              showDeckDetail.cards.map((card, index) =>
                React.createElement('div', {
                  key: index,
                  className: "flex items-center justify-between bg-slate-800/30 border border-violet-500/10 rounded-lg px-4 py-3 hover:bg-slate-800/50 transition-all"
                },
                  React.createElement('span', { className: "text-violet-200" }, card.name),
                  React.createElement('span', { className: "text-violet-400/60 text-sm" }, 'x' + card.quantity)
                )
              )
            )
          ),
          React.createElement('div', { className: "px-6 py-5 border-t border-violet-500/20 flex gap-3" },
            React.createElement('button', {
              onClick: () => {
                if (confirm('Â¿EstÃ¡s seguro de eliminar este mazo?')) {
                  handleDeleteDeck(showDeckDetail.id);
                  setShowDeckDetail(null);
                }
              },
              className: "flex-1 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 text-red-300 rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-all font-semibold"
            },
              React.createElement(Trash2, { className: "w-5 h-5" }),
              'Eliminar'
            ),
            React.createElement('button', {
              onClick: () => {
                startGame(showDeckDetail);
                setShowDeckDetail(null);
              },
              className: "flex-1 bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 transition-all shadow-lg font-semibold"
            },
              React.createElement(Play, { className: "w-5 h-5" }),
              'Jugar'
            )
          )
        )
      )
    );
  }

  // NUEVO: Vista de JUEGO MULTIJUGADOR
  if (currentView === 'game' && currentGame) {
    const currentPlayer = currentGame.players.find(p => p.name === playerName);

    return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-950 via-violet-950 to-slate-950 pb-20" },
      React.createElement('div', { className: "sticky top-0 z-20 backdrop-blur-xl bg-black/40 border-b border-violet-500/20" },
        React.createElement('div', { className: "px-4 py-3 flex items-center justify-between" },
          React.createElement('div', { className: "flex items-center gap-3" },
            React.createElement('button', {
              onClick: () => {
                if (confirm('Â¿Salir de la partida?')) {
                  setCurrentView('home');
                  setCurrentGame(null);
                }
              },
              className: "text-violet-300 hover:text-violet-200 transition-colors"
            }, React.createElement(ChevronLeft, { className: "w-6 h-6" })),
            React.createElement('div', null,
              React.createElement('h2', { className: "text-lg font-bold text-white" }, 'Partida en Curso'),
              React.createElement('p', { className: "text-xs text-violet-400" }, 'Turno ' + currentGame.turn)
            )
          ),
          React.createElement('div', { className: "flex items-center gap-2" },
            React.createElement('button', {
              onClick: copyGameId,
              className: "p-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 rounded-lg transition-all"
            }, React.createElement(Copy, { className: "w-5 h-5" })),
            React.createElement('button', {
              onClick: () => setShowChat(!showChat),
              className: "relative p-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 rounded-lg transition-all"
            },
              React.createElement(MessageCircle, { className: "w-5 h-5" }),
              currentGame.messages.length > 0 && React.createElement('span', { className: "absolute -top-1 -right-1 w-3 h-3 bg-fuchsia-500 rounded-full" })
            )
          )
        )
      ),
      React.createElement('div', { className: "p-4 grid grid-cols-1 md:grid-cols-2 gap-4" },
        currentGame.players.map((player) =>
          React.createElement('div', {
            key: player.id,
            className: "backdrop-blur-xl bg-white/5 border rounded-2xl p-5 transition-all",
            style: {
              borderColor: player.id === currentPlayer?.id ? player.color : 'rgba(139, 92, 246, 0.2)',
              boxShadow: player.id === currentPlayer?.id ? '0 0 20px ' + player.color + '40' : 'none'
            }
          },
            React.createElement('div', { className: "flex items-center justify-between mb-4" },
              React.createElement('div', { className: "flex items-center gap-3" },
                React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: player.color } }),
                React.createElement('div', null,
                  React.createElement('h3', { className: "text-lg font-bold text-white" }, player.name),
                  player.deck?.commander && React.createElement('p', { className: "text-xs text-violet-400 flex items-center gap-1" },
                    React.createElement(Crown, { className: "w-3 h-3 text-amber-400" }),
                    player.deck.commander
                  )
                )
              ),
              player.id === currentPlayer?.id && React.createElement('span', { className: "bg-violet-600/30 border border-violet-500/50 text-violet-200 text-xs px-3 py-1 rounded-full font-semibold" }, 'TÃº')
            ),
            React.createElement('div', { className: "mb-4" },
              React.createElement('div', { className: "flex items-center justify-between mb-3" },
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement(Heart, { className: "w-5 h-5 text-red-400" }),
                  React.createElement('span', { className: "text-sm text-violet-300 font-semibold" }, 'Vida')
                ),
                React.createElement('span', {
                  className: "text-4xl font-bold tabular-nums",
                  style: {
                    color: player.life > 20 ? '#10b981' : player.life > 10 ? '#f59e0b' : '#ef4444'
                  }
                }, player.life)
              ),
              player.id === currentPlayer?.id && React.createElement('div', { className: "grid grid-cols-4 gap-2" },
                React.createElement('button', {
                  onClick: () => updatePlayerLife(player.id, -10),
                  className: "bg-red-500/20 border border-red-500/30 hover:bg-red-500/30 text-red-300 rounded-lg py-2 text-sm font-semibold transition-all"
                }, '-10'),
                React.createElement('button', {
                  onClick: () => updatePlayerLife(player.id, -1),
                  className: "bg-red-500/20 border border-red-500/30 hover:bg-red-500/30 text-red-300 rounded-lg py-2 text-sm font-semibold transition-all"
                }, '-1'),
                React.createElement('button', {
                  onClick: () => updatePlayerLife(player.id, 1),
                  className: "bg-green-500/20 border border-green-500/30 hover:bg-green-500/30 text-green-300 rounded-lg py-2 text-sm font-semibold transition-all"
                }, '+1'),
                React.createElement('button', {
                  onClick: () => updatePlayerLife(player.id, 10),
                  className: "bg-green-500/20 border border-green-500/30 hover:bg-green-500/30 text-green-300 rounded-lg py-2 text-sm font-semibold transition-all"
                }, '+10')
              )
            ),
            currentGame.players.length > 1 && React.createElement('div', { className: "mb-4" },
              React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                React.createElement(Swords, { className: "w-4 h-4 text-orange-400" }),
                React.createElement('span', { className: "text-xs text-violet-300 font-semibold" }, 'DaÃ±o de Comandante')
              ),
              React.createElement('div', { className: "space-y-2" },
                currentGame.players.filter(p => p.id !== player.id).map(opponent =>
                  React.createElement('div', {
                    key: opponent.id,
                    className: "flex items-center justify-between text-sm bg-slate-800/30 rounded-lg px-3 py-2"
                  },
                    React.createElement('span', { className: "text-violet-400 flex items-center gap-2" },
                      React.createElement('div', { className: "w-2 h-2 rounded-full", style: { backgroundColor: opponent.color } }),
                      opponent.name
                    ),
                    React.createElement('div', { className: "flex items-center gap-2" },
                      React.createElement('span', {
                        className: "font-bold tabular-nums",
                        style: {
                          color: (player.commanderDamage[opponent.id] || 0) >= 15 ? '#ef4444' : '#a78bfa'
                        }
                      }, player.commanderDamage[opponent.id] || 0),
                      player.id === currentPlayer?.id && React.createElement('div', { className: "flex gap-1" },
                        React.createElement('button', {
                          onClick: () => updateCommanderDamage(player.id, opponent.id, 1),
                          className: "w-7 h-7 bg-orange-500/20 border border-orange-500/30 hover:bg-orange-500/30 text-orange-300 rounded text-xs font-bold transition-all"
                        }, '+'),
                        React.createElement('button', {
                          onClick: () => updateCommanderDamage(player.id, opponent.id, -1),
                          className: "w-7 h-7 bg-orange-500/20 border border-orange-500/30 hover:bg-orange-500/30 text-orange-300 rounded text-xs font-bold transition-all"
                        }, '-')
                      )
                    )
                  )
                )
              )
            ),
            React.createElement('div', { className: "flex items-center justify-between bg-slate-800/30 rounded-lg px-3 py-2" },
              React.createElement('div', { className: "flex items-center gap-2" },
                React.createElement(Skull, { className: "w-4 h-4 text-green-400" }),
                React.createElement('span', { className: "text-sm text-violet-300 font-semibold" }, 'Veneno')
              ),
              React.createElement('div', { className: "flex items-center gap-2" },
                React.createElement('span', {
                  className: "text-lg font-bold tabular-nums",
                  style: {
                    color: player.poison >= 8 ? '#ef4444' : player.poison >= 5 ? '#f59e0b' : '#10b981'
                  }
                }, player.poison),
                player.id === currentPlayer?.id && React.createElement('div', { className: "flex gap-1" },
                  React.createElement('button', {
                    onClick: () => updatePoison(player.id, 1),
                    className: "w-7 h-7 bg-green-500/20 border border-green-500/30 hover:bg-green-500/30 text-green-300 rounded text-xs font-bold transition-all"
                  }, '+'),
                  React.createElement('button', {
                    onClick: () => updatePoison(player.id, -1),
                    className: "w-7 h-7 bg-green-500/20 border border-green-500/30 hover:bg-green-500/30 text-green-300 rounded text-xs font-bold transition-all"
                  }, '-')
                )
              )
            )
          )
        )
      ),
      showChat && React.createElement('div', { className: "fixed bottom-20 left-0 right-0 mx-4 md:mx-auto md:max-w-2xl z-30" },
        React.createElement('div', { className: "backdrop-blur-xl bg-slate-900/95 border border-violet-500/30 rounded-2xl shadow-2xl overflow-hidden" },
          React.createElement('div', { className: "px-4 py-3 bg-violet-500/10 border-b border-violet-500/20 flex items-center justify-between" },
            React.createElement('h3', { className: "text-white font-semibold" }, 'Chat'),
            React.createElement('button', {
              onClick: () => setShowChat(false),
              className: "text-violet-400 hover:text-violet-300 transition-colors"
            }, React.createElement(X, { className: "w-5 h-5" }))
          ),
          React.createElement('div', { className: "h-64 overflow-y-auto p-4 space-y-3" },
            currentGame.messages.length === 0 ?
              React.createElement('p', { className: "text-violet-400/50 text-sm text-center py-8" }, 'No hay mensajes aÃºn') :
              currentGame.messages.map((msg) =>
                React.createElement('div', {
                  key: msg.id,
                  className: 'flex flex-col gap-1 ' + (msg.player === playerName ? 'items-end' : 'items-start')
                },
                  React.createElement('span', { className: "text-xs text-violet-400" }, msg.player),
                  React.createElement('div', {
                    className: 'max-w-[80%] px-4 py-2 rounded-xl ' + (msg.player === playerName ? 'bg-violet-600 text-white' : 'bg-slate-800 text-violet-200')
                  },
                    React.createElement('p', { className: "text-sm" }, msg.text)
                  )
                )
              ),
            React.createElement('div', { ref: chatEndRef })
          ),
          React.createElement('div', { className: "p-4 bg-slate-800/50 border-t border-violet-500/20" },
            React.createElement('div', { className: "flex gap-2" },
              React.createElement('input', {
                type: "text",
                value: chatMessage,
                onChange: (e) => setChatMessage(e.target.value),
                onKeyPress: (e) => e.key === 'Enter' && sendMessage(),
                placeholder: "Escribe un mensaje...",
                className: "flex-1 bg-slate-900/50 border border-violet-500/30 rounded-xl px-4 py-2 text-white placeholder-violet-400/40 focus:outline-none focus:border-violet-400 transition-all text-sm"
              }),
              React.createElement('button', {
                onClick: sendMessage,
                className: "bg-violet-600 hover:bg-violet-500 text-white rounded-xl px-4 py-2 transition-all"
              }, React.createElement(Send, { className: "w-5 h-5" }))
            )
          )
        )
      ),
      !showChat && React.createElement('button', {
        onClick: () => setShowChat(true),
        className: "fixed bottom-24 right-4 bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white p-4 rounded-full shadow-2xl transition-all z-20"
      },
        React.createElement(MessageCircle, { className: "w-6 h-6" }),
        currentGame.messages.length > 0 && React.createElement('span', { className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold" }, currentGame.messages.length)
      )
    );
  }

  return null;
}

const root = createRoot(document.getElementById('root'));
root.render(React.createElement(MTGCommanderApp));
```

  </script>
</body>
</html>
